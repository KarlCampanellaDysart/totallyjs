define(["jsingleton"],function(e){var t="expected_data",n={call:function(e,t,n,r){var i;window.XMLHttpRequest!==undefined?i=new XMLHttpRequest:i=new ActiveXObject("Microsoft.XMLHTTP"),i.onreadystatechange=function(){if(i.readyState===4&&i.status===200){var e;try{e=JSON.parse(i.responseText)}catch(t){e=i.responseText}r(e)}};var s="?";for(var o in n)s+=o+"="+JSON.stringify(n[o])+"&";i.open(e,t+s,!0),i.send()},smart:function(n,r,i,s){var o={add:"PUT",get:"GET",getAll:"GET",update:"PUT","delete":"DELETE"};for(var u in e.singleton.models[r].backend.config.routes[n][t])if(i[e.singleton.models[r].backend.config.routes[n][t][u]]===undefined)throw"expected data "+e.singleton.models[r].backend.config.routes[n][t][u]+" not found";var a=this.insertDataInRoutes(i,r,n);this.call(o[n],a.route,a.params,s)},insertDataInRoutes:function(t,n,r){var i=e.singleton.models[n].backend.config,s=i.routes[r].route,o=s.split("|"),u="";for(var a in o)if(o[a].indexOf("/")===-1&&o[a]!==""){if(t[o[a]]===undefined)throw"undefined data in route";u+=t[o[a]]}else u+=o[a];var f={};for(var l in i.routes[r].params)f[i.routes[r].params[l].name]=t[i.routes[r].params[l].name];return{route:u,params:f}}};return n});