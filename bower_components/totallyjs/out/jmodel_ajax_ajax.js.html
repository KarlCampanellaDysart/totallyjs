<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: jmodel/ajax/ajax.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: jmodel/ajax/ajax.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

define([

  /**
  	* @requires jsingleton
	*/
	'jsingleton'

], function(js){
	
	var EXP_DATA = 'expected_data';

  /**
	* Ajax Module - module for performing network requests

	* @exports jmodel/ajax/ajax
	*/
	var ajax = {

	  /**
		* Function to make a basic ajax call

		* @function call
		* @alias jmodel/ajax/ajax.call

		* @param {string} _type - type of request
		* @param {string} _route - path of the route to be called
		* @param {Object} _reqData - data to be included either as a route parameter or route query
		* @param {function} _callback - function to execute after request is complete
		*/
		call: function(_type, _route, _reqdata, _callback){

			//init the req object
			var req;
			if (window.XMLHttpRequest !== undefined){ req = new XMLHttpRequest(); }
			else{ req = new ActiveXObject('Microsoft.XMLHTTP'); }

			//when we get a response that is successufll 
			req.onreadystatechange = function(){ if(req.readyState === 4 &amp;&amp; req.status === 200){ 
				var result;
				try{ result = JSON.parse(req.responseText); }
				catch(error){ result = req.responseText; }
				_callback(result); 
			}}

			//set up params binded to the url
			var reqstring = '?';
			for(var i in _reqdata){ reqstring += i + '=' + JSON.stringify(_reqdata[i]) + '&amp;'; }

			//send request asychronously
			req.open(_type, _route + reqstring, true); req.send();
		},

	  /**
		* Function to make an abstracted ajax call unique to restful web interfaces

		* @function smart
		* @alias jmodel/ajax/ajax.smart

		* @param {string} _type - type of restful request
		* @param {string} _modelName - name of the model for which the data is being sent
		* @param {Object} _data - data to be included either as a route parameter or route query
		* @param {function} _callback - function to execute after request is complete
		*/
		smart: function(_type, _modelName, _data, _callback){
			
			//type map
			var reqTypeMap = {
				add: 'PUT',
				get: 'GET',
				getAll: 'GET',
				update: 'PUT',
				delete: 'DELETE'
			};

			//check the data
			for(var i in js.singleton.models[_modelName].backend.config.routes[_type][EXP_DATA]){
				if(_data[js.singleton.models[_modelName].backend.config.routes[_type][EXP_DATA][i]] === undefined){ 
					throw 'expected data ' + js.singleton.models[_modelName].backend.config.routes[_type][EXP_DATA][i] + ' not found'; 
				}
			}

			//add stuff to the backend
			var reqData = this.insertDataInRoutes(_data, _modelName, _type);
			this.call(reqTypeMap[_type], reqData.route, reqData.params, _callback);
		},

	  /**
		* Function to make an abstracted ajax call unique to restful web interfaces

		* @function insertDataInRoutes
		* @alias jmodel/ajax/ajax.insertDataInRoutes
		
		* @param {Object} _data - data to be included either as a route parameter or route query
		* @param {string} _modelName - name of the model for which the data is being sent
		* @param {string} _method - type of restful request
		* @returns {Object} _data separated by its method of sending (parameter or query)
		*/
		insertDataInRoutes: function(data, modelName, method){
			var backend = js.singleton.models[modelName].backend.config;
			var routeString = backend.routes[method].route;
			var splitRoute = routeString.split('|');
			var newRouteString = '';
			for(var j in splitRoute){

				//didnt find a route parameter
				if(splitRoute[j].indexOf('/') === -1 &amp;&amp; splitRoute[j] !== ''){

					//it should be in data
					if(data[splitRoute[j]] === undefined){ throw 'undefined data in route'; }
					newRouteString += data[splitRoute[j]];
				}
				//found formatted part of route
				else{ newRouteString += splitRoute[j]; }
			}

			var allParams = {};
			for(var i in backend.routes[method].params){ allParams[backend.routes[method].params[i].name] = data[backend.routes[method].params[i].name]; }

			return {route: newRouteString, params: allParams};
		}
	};
	
	//export ajax object
	return ajax;
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-jcontroller_jcontroller.html">jcontroller/jcontroller</a></li><li><a href="module-jcontroller_render.html">jcontroller/render</a></li><li><a href="module-jcontroller_subcontrollers_helperController.html">jcontroller/subcontrollers/helperController</a></li><li><a href="module-jcontroller_subcontrollers_listener_listenerObject.html">jcontroller/subcontrollers/listener/listenerObject</a></li><li><a href="module-jcontroller_subcontrollers_listener_listenerQueues.html">jcontroller/subcontrollers/listener/listenerQueues</a></li><li><a href="module-jcontroller_subcontrollers_listenerController.html">jcontroller/subcontrollers/listenerController</a></li><li><a href="module-jcontroller_subcontrollers_modelController.html">jcontroller/subcontrollers/modelController</a></li><li><a href="module-jcontroller_subcontrollers_viewController.html">jcontroller/subcontrollers/viewController</a></li><li><a href="module-jhelper_jhelper.html">jhelper/jhelper</a></li><li><a href="module-jjs.html">jjs</a></li><li><a href="module-jloader_jloader.html">jloader/jloader</a></li><li><a href="module-jloader_jsync.html">jloader/jsync</a></li><li><a href="module-jmodel_ajax_ajax.html">jmodel/ajax/ajax</a></li><li><a href="module-jmodel_alterModel_add.html">jmodel/alterModel/add</a></li><li><a href="module-jmodel_alterModel_delete.html">jmodel/alterModel/delete</a></li><li><a href="module-jmodel_alterModel_get.html">jmodel/alterModel/get</a></li><li><a href="module-jmodel_alterModel_update.html">jmodel/alterModel/update</a></li><li><a href="module-jmodel_indicies.html">jmodel/indicies</a></li><li><a href="module-jmodel_jmodel.html">jmodel/jmodel</a></li><li><a href="module-jmodel_modelValidation.html">jmodel/modelValidation</a></li><li><a href="module-jrouter_jrouter.html">jrouter/jrouter</a></li><li><a href="module-jrouter_location_locationHandler.html">jrouter/location/locationHandler</a></li><li><a href="module-jrouter_location_locationObject.html">jrouter/location/locationObject</a></li><li><a href="module-jsingleton.html">jsingleton</a></li><li><a href="module-jview_jview.html">jview/jview</a></li><li><a href="module-jview_jviewObject.html">jview/jviewObject</a></li><li><a href="module-jview_tags_tagContentParser.html">jview/tags/tagContentParser</a></li><li><a href="module-jview_tags_tagObject.html">jview/tags/tagObject</a></li><li><a href="module-jview_tags_tagObjectRender.html">jview/tags/tagObjectRender</a></li><li><a href="module-jview_tags_tags.html">jview/tags/tags</a></li><li><a href="module-jview_viewChange.html">jview/viewChange</a></li><li><a href="module-viewObjectParser.html">viewObjectParser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Mon Aug 17 2015 00:42:16 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
